<!DOCTYPE html>
<html>
<head>
  <title>Render GeoTIFF on Leaflet Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/geotiff.js@1.0.6/dist/geotiff.js"></script>
  <style>
    #map {
      height: 400px;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    var map = L.map('map').setView([0, 0], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map data Â© <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'
    }).addTo(map);

    var imageUrl = '../imagery/TrentUniFreeTIFs/A02033-009_cog.tif';

    fetch(imageUrl)
      .then(function(response) {
        return response.arrayBuffer();
      })
      .then(function(arrayBuffer) {
        var tiff = GeoTIFF.parse(arrayBuffer);
        var image = tiff.getImage();
        var width = image.getWidth();
        var height = image.getHeight();
        var rasters = image.readRasters();

        var canvas = document.createElement('canvas');
        var ctx = canvas.getContext('2d');
        canvas.width = width;
        canvas.height = height;

        var imageData = ctx.createImageData(width, height);
        var data = imageData.data;
        for (var i = 0; i < width * height; i++) {
          data[i * 4] = rasters[0][i];     // Red channel
          data[i * 4 + 1] = rasters[1][i]; // Green channel
          data[i * 4 + 2] = rasters[2][i]; // Blue channel
          data[i * 4 + 3] = 255;           // Alpha channel
        }
        ctx.putImageData(imageData, 0, 0);

        var bounds = L.latLngBounds([[image.getBoundingBox()[1], image.getBoundingBox()[0]], [image.getBoundingBox()[3], image.getBoundingBox()[2]]]);
        L.imageOverlay(canvas.toDataURL(), bounds).addTo(map);
      })
      .catch(function(error) {
        console.log('Error loading GeoTIFF:', error);
      });
  </script>
</body>
</html>
